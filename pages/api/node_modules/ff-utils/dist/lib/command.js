"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const child_process_1 = require("child_process");
class Command {
    constructor(cmd, args) {
        this.cmd = cmd;
        this.args = args;
    }
    run() {
        const cp = child_process_1.spawn(this.cmd, this.args, {
            stdio: 'pipe'
        });
        return new Promise((resolve, reject) => {
            const outStream = cp.stdout;
            const err = cp.stderr;
            cp.on('close', code => {
                if (code === 0 || code === null) {
                    return;
                }
                outStream.emit('error', `${this.cmd} has exited with error code ${code}.`);
            });
            cp.on('error', (err) => {
                console.error(err);
            });
            err.on('data', chunk => {
                console.log(chunk.toString('utf8'));
            });
            const buffers = [];
            outStream.on('data', chunk => {
                buffers.push(chunk);
            });
            outStream.on('end', () => {
                resolve(Buffer.concat(buffers).toString('utf8'));
            });
        });
    }
}
exports.Command = Command;
//# sourceMappingURL=command.js.map